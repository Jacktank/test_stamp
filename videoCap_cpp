#include <iostream>
#include <opencv2/opencv.hpp>

int main(int argc,char* argv[])
{
		std::string input_source;
		if(argc == 1)
		{
				input_source = std::string("rtsp://admin:12345goccia@10.0.0.3:554//Streaming/Channels/1");
		}
		else if(argc == 2)
		{
				input_source = std::string(argv[1]);
		}

    cv::VideoCapture capture(input_source);
    if(!capture.isOpened())
    {
        std::cout<<"video not open."<<std::endl;
        return 1;
    }
    //获取当前视频帧率
    double rate = capture.get(CV_CAP_PROP_FPS);
    //当前视频帧
    cv::Mat frame;
    //每一帧之间的延时
    //与视频的帧率相对应
    int delay = 1000/rate;
		std::cout<<"delay time: "<<delay<<std::endl;
		bool stop(false);
	  while(!stop)
    {
        if(!capture.read(frame))
        {
            std::cout<<"no video frame"<<std::endl;
            break;
        }
        //此处为添加对视频的每一帧的操作方法
        int frame_num = capture.get(CV_CAP_PROP_POS_FRAMES);
        std::cout<<"Frame Num : "<<frame_num<<std::endl;
		
			  cv::imshow("video",frame);
        //引入延时
        //也可通过按键停止
				int k = cv::waitKey(1);
				//int k = cv::waitKey(delay);
        if(k == 'q')
				{
						stop = true;
				}
				
		}

    //关闭视频，手动调用析构函数（非必须）
    capture.release();
    return 0;
}


